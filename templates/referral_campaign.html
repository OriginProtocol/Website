{% extends 'base.html' %}

{% block title %}{{ gettext("Get Origin Protocol") }}{% endblock %}

{% block meta_description %}{{ gettext("Get Origin Protocol") }}{% endblock %}

{% block extra_styles %}
<link href="https://fonts.googleapis.com/css?family=Poppins&display=swap" rel="stylesheet" />
<style type="text/css">
  body {
    background: #007fff;
    color: #fff;
  }
  .referral-campaign-page {}
  .referral-campaign-page hr {
    background: #fff;
    height: 1px;
    width: 84%;
    border: 0;
  }
  .referral-campaign-page .desktop {}
  #app-download-button {
    font-size: 1.125rem;
    width: 100%;
    border-radius: 26px;
    border: solid 1px var(--white);
    padding: 12px 0;
    margin: 0 auto 50px;
    max-width: 350px;
    color: white;
    background-color: transparent;
    text-align: center;
    visibility: hidden;
  }
  #app-download-button:hover {
    background-color: #036ddd;
    cursor: pointer;
  }
  #referral-campaign-header {
    display: block;
    margin-top: 10px;
    margin-left: 10px;
  }
  #referral-campaign-header .logo {
    display: block;
    margin: 10px 0;
    padding: 15px;
  }
  #referral-campaign-header .logo img {
    height: 22px;
    width: auto;
    margin: 10px auto;
  }
  #referral-campaign-header .partner.logo {}
  #referral-campaign-header .origin.logo {}
  #tagline {
    margin: 0 25px 25px;
  }
  #tagline p {
  }
  #intro {}
  #intro p {
    font-family: Lato, sans-serif;
    font-size: 20px;
    line-height: 1.3;
    margin: 30px;
  }
  #callout {}
  #callout p {
    font-family: "Poppins", sans-serif;
    text-align: center;
    font-size: 27px;
    font-weight: 1000;
    text-transform: uppercase;
  }
  #callout .value {
    display: block;
    font-size: 72px;
  }
  #download {
    text-align: center;
  }
  #rewards {
    font-family: Lato, sans-serif;
    font-size: 18px;
    line-height: 1.44;
    margin: 30px;
  }
  #rewards h2 {
    font-family: Lato, sans-serif;
    font-size: 18px;
    font-weight: bold;
  }
  #screenshot1 {
    text-align: center;
  }
  #screenshot1 img,
  #screenshot2 img,
  #screenshot2-desktop img {
    /* these have some drop shadow on the right */
    position: relative;
    left: 15px;
  }
  #screenshot1 hr {
    width: 100%;
    margin: 0;
  }
  #screenshot2 {
    text-align: center;
  }
  #screenshot2 img {}
  #screenshot2 hr {
    width: 100%;
    margin: 0;
  }
  #testing {}

  .avatar-container {}
  .avatar {
    float: left;
    height: 80px;
    width: 80px;
    border: 1px #fff solid;
    border-radius: 40px;
    margin: 5px;
    padding: 0;
    overflow: hidden;
    background-position: center;
    background-size: contain;
  }
  .avatar img {
    /*max-height: 80px;
    max-width: 80px;*/
  }
  .avatar-container p {
    display: block;
    margin: 0 auto;
    padding-top: 15px;
    font-family: "Lato" sans-serif;
    font-size: 20px;
    line-height: 1.3;
    text-align: left;
  }

  @media only screen and (min-width: 768px) {
    .referral-campaign-page {
      padding-bottom: 50px;
      clear: both;
    }
    #app-download-button {
      margin-bottom: 0;
    }
    #screenshot1 {
      margin-top: 100px;
    }
    #screenshot1 hr,
    #screenshot2 hr {
      display: none;
    }
    #tagline p { font-size: 25px; }
    #callout { font-size: 32px }
    #callout .value { font-size: 88px }
    #intro p { font-size: 18px; }
    #referral-campaign-header {
      margin-left: 30px;
    }
    #referral-campaign-header .origin.logo {}

    #screenshot1 img,
    #screenshot2 img,
    #screenshot2-desktop img {
      left: 0;
    }

    .avatar {
      margin: 25px;
    }
    .avatar-container p {
      padding-top: 30px;
    }
    .qrcode-wrapper p {
      font-family: Lato, sans-serif;
      font-size: 14px;
      font-weight: normal;
      line-height: 1.86;
      margin-top: 2px;
      text-align: center;
    }
    .qrcode-wrapper img {
      margin: 0 auto;
      margin-top: 10px;
    }
    .qrcode-wrapper {
      background: #fff;
      color: #000;
      padding: 5px;
      margin: 0 auto;
      width: 190px;
      height: 190px;
      border-radius: 20px;
    }
    .what .qrcode-wrapper {
      margin: 0 0 0 30px;
    }
    .page-splitter {
      width: 100%;
      margin: 50px auto;
    }
  }

  @media only screen and (min-width: 990px) {
    #screenshot1 img,
    #screenshot2 img,
    #screenshot2-desktop img {
      left: 60px;
    }
  }

  @media only screen and (min-width: 1200px) {
    #screenshot1 img,
    #screenshot2 img,
    #screenshot2-desktop img {
      left: 110px;
    }
  }
</style>
{% endblock %}

{% block extra_scripts %}
  <script src="/static/js/qrcode.min.js" type="text/javascript"></script>
  <script>
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)
    const isIOS = navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform)
    const referalCode = `{{ referral_code }}`
    const me = `${location.origin}/referral/{{ referral_code }}`
    const prefix = 'or:'

    const qrOptions = {
      text: me,
      width: 140,
      height: 140,
      colorDark : "#000000",
      colorLight : "#ffffff",
      correctLevel : QRCode.CorrectLevel.H
    }
    const qrcode1 = new QRCode('qrcode1', qrOptions)
    const qrcode2 = new QRCode('qrcode2', qrOptions)

    /**
     * Copy a string to the clipboard
     */
    function codeToClipboard(code) {
      if (!code) {
        console.error('no code provided to copy to clipboard')
        return
      }
      // Prefix it for mobile use
      code = code.startsWith(prefix) ? code : `${prefix}${code}`

      // Use navigator.clipboard if available (cleaner)
      if (navigator.clipboard) {
        return navigator.clipboard.writeText(code)
      }

      // The hard way because it's a crap browser
      return new Promise((resolve, reject) => {
        // Create element
        const tmp = document.createElement('span')
        tmp.style.display = 'none'
        tmp.textContent = code
        document.body.appendChild(tmp)

        // Selection
        const sel = document.getSelection()
        sel.removeAllRanges()

        // Range
        const rng = document.createRange()
        rng.selectNodeContents(tmp)

        // Add the range to the selection
        sel.addRange(rng)

        // Copy the text in the range
        const res = document.execCommand('copy')
        document.body.removeChild(tmp)
        if (!res) {
          reject('Failed to execute copy of text')
        }
        resolve()
      })
    }

    /**
     * handle download button click and go to the appropriate download page
     */
    function continueReferral() {
      if (isMobile) {
        let url = '{{ play_store_url }}'
        if (isIOS) {
          url = '{{ app_store_url }}'
        }
        codeToClipboard(referalCode).then(() => {
          const win = window.open(url)
          // If we got snagged by a popup blocker(firefox) just go direct
          if (!win) {
            window.location = url
          }
        }).catch((err) => {
          console.error('Problem copying code to clipboard')
          console.error(err)
          window.location = url
        })
      } else {
        const url = `https://shoporigin.com/#/welcome/${referalCode}`
        const win = window.open(url)
        // If we got snagged by a popup blocker(firefox) just go direct
        if (!win) {
          window.location = url
        }
      }
    }

    /**
     * Figure out which button to display
     */
    function detectButton(code) {
      if (!code) {
        console.error('no code provided to detectButton')
      }

      const button = document.getElementById('app-download-button')
      if (!button) {
        console.warn('Did not find #app-download-button')
        return
      }
      button.style.visibility = 'visible'
      if (isMobile) {
        button.style.backgroundRepeat = 'no-repeat'
        button.style.backgroundSize = 'cover'
        button.style.border = 'none'
        button.style.borderRadius = '12px'
        button.style.width = '280px'
        if (isIOS) {
          console.log('ios')
          button.style.backgroundImage = 'url(/static/img/app-store.svg)'
          button.style.height = `${280 / 3}px`
        } else {
          console.log('not-ios')
          button.style.backgroundImage = 'url(/static/img/play-store.svg)'
          button.style.height = `${280 / 3.33}px`
        }
      } else {
        button.innerHTML = 'Earn From Desktop'
      }

      if (code) {
        button.addEventListener('click', e => {
          codeToClipboard(code)
        })
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      detectButton(referalCode)
      const values = document.getElementsByClassName('value')
      for (const el of values) {
        el.innerHTML = Number(el.innerHTML).toLocaleString()
      }
    })
  </script>
{% endblock %}

{% block content %}

<main class="referral-campaign-page">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <div id="referral-campaign-header">
          <div class="origin logo"><a href="/"><img src="/static/img/origin-logo@3x.png" alt="Origin" /></a></div>
        </div>
        <section id="tagline">
          <div class="avatar-container clearfix">
            <div class="avatar" style="background-image: url({{ friend_avatar }})"></div>
            <p class="avatar-text">{{ gettext("Your friend") }} {{ friend_name }} {{ gettext("has invited you to earn") }}</p>
          </div>
        </section>
        <hr />
        <section id="callout">
          <p><span class="value">{{ reward_value }}</span> {{ gettext("Origin Tokens") }}</p>
        </section>
        <hr />
        <section id="intro">
          <p>{{ gettext("Get started by downloading Origin Marketplace - the app that allows you to buy and sell anything using crypto right from your phone.") }}</p>
        </section>
        <section class="qrcode-wrapper d-none d-md-block">
          <div id="qrcode1"></div>
          <p>{{ gettext("Scan to install our app") }}</p>
        </section>
        <p id="conjunction" class="d-none d-md-block mb-2 mt-2 text-center">{{ gettext("or") }}</p>
        <section id="download">
          <button id="app-download-button" onclick="continueReferral()"></button>
        </section>
      </div>
      <div class="col-md-6">
        <section id="screenshot1">
          <img class="d-md-none" src="/static/img/partner/iphone-1.png" />
          <img class="d-none d-md-block" src="/static/img/partner/iphone-1-full.png" />
          <hr />
        </section>
      </div>
    </div>
  </div>
  <hr class="d-none d-md-block page-splitter" />
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <section id="screenshot2-desktop" class="d-none d-md-block">
          <img src="/static/img/partner/iphone-2-full.png" />
          <hr class="d-md-none" />
        </section>
      </div>
      <div class="col-md-6 what">
        <section id="rewards">
          <h2>{{ gettext("What are Origin Rewards?") }}</h2>
          <p>{{ gettext("OGN is a rewards cryptocurrency earned by Origin users. Earn rewards when you verify your account or invite your friends to join Origin. Even get OGN as cash back when you buy and sell.") }}</p>
        </section>
        <section id="screenshot2" class="d-md-none">
          <img src="/static/img/partner/iphone-2.png" />
          <hr />
        </section>
        <section class="qrcode-wrapper d-none d-md-block">
          <div id="qrcode2"></div>
          <p>{{ gettext("Scan to install our app") }}</p>
        </section>
      </div>
    </div>
  </div>
</main>

{% endblock %}